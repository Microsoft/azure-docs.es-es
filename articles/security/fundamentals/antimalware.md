---
title: Microsoft Antimalware para Azure | Microsoft Docs
description: Obtenga más información acerca de Microsoft Antimalware para Azure Cloud Services y Virtual Machines. Consulte la información sobre temas como escenarios de arquitectura e implementación.
services: security
documentationcenter: na
author: terrylanfear
manager: barbkess
editor: ''
ms.assetid: 265683c8-30d7-4f2b-b66c-5082a18f7a8b
ms.service: security
ms.subservice: security-fundamentals
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/26/2019
ms.author: terrylan
ms.openlocfilehash: c96af2522cfa7918c12e77328a5b441d22fc3dc3
ms.sourcegitcommit: 8def3249f2c216d7b9d96b154eb096640221b6b9
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 08/03/2020
ms.locfileid: "87541760"
---
# <a name="microsoft-antimalware-for-azure-cloud-services-and-virtual-machines"></a>Microsoft Antimalware para Azure Cloud Services y Virtual Machines

Microsoft Antimalware para Azure es una protección gratuita en tiempo real que ayuda a identificar y eliminar virus, spyware y otro software malintencionado. Genera alertas cuando software no deseado o malintencionado intenta instalarse o ejecutarse en los sistemas de Azure.

La solución se basa en la misma plataforma antimalware que Microsoft Security Essentials \[(MSE)\], Microsoft Forefront Endpoint Protection, Microsoft System Center Endpoint Protection, Windows Intune y Windows Defender. Microsoft Antimalware para Azure es una solución de un único agente dirigida a entornos de aplicaciones e inquilinos, concebida para ejecutarse en segundo plano sin intervención humana. La protección puede implementarse en función de las necesidades de sus cargas de trabajo de aplicaciones, con configuración de protección básica predeterminada o personalizada avanzada que incluye la supervisión antimalware.

Al implementar y habilitar Microsoft Antimalware para Azure en sus aplicaciones, están disponibles las siguientes características principales:

* **Protección en tiempo real**: supervisa la actividad en Cloud Services y Virtual Machines para detectar y bloquear la ejecución de malware.
* **Análisis programado**: realiza un análisis periódico para detectar malware, lo que incluye programas que se ejecutan activamente.
* **Corrección de malware**: actúa automáticamente sobre el malware detectado y elimina o pone en cuarentena los archivos malintencionados y limpia las entradas del Registro malintencionadas.
* **Actualizaciones de firmas**: instala automáticamente las últimas firmas de protección (definiciones de virus) para garantizar que la protección está actualizada con una frecuencia determinada previamente.
* **Actualizaciones de Antimalware Engine**: actualiza automáticamente el motor de Microsoft Antimalware.
* **Actualizaciones de la plataforma antimalware**: actualiza automáticamente la plataforma de Microsoft Antimalware.
* **Protección activa**: envía a Microsoft Azure informes de metadatos de telemetría sobre las amenazas detectadas y los recursos sospechosos para garantizar una respuesta rápida a las amenazas en constante evolución, y para permitir la entrega sincrónica de firmas en tiempo real a través de Microsoft Active Protection System (MAPS).
* **Informes de ejemplos**: proporciona informes de ejemplos al servicio Microsoft Antimalware que ayudan a mejorar el servicio y permiten la solución de problemas.
* **Exclusiones** : permite a los administradores de aplicaciones y servicios configurar las exclusiones de archivos, procesos y unidades.  
* **Recopilación de eventos antimalware**: registra el estado del servicio antimalware, las actividades sospechosas y las acciones de corrección adoptadas en el registro de eventos del sistema operativo y los recopila en la cuenta de Azure Storage del cliente.

> [!NOTE]
> Microsoft Antimalware también puede implementarse mediante Azure Security Center. Para más información, vea [Instalación de Endpoint Protection en Azure Security Center](../../security-center/security-center-install-endpoint-protection.md).

## <a name="architecture"></a>Architecture

La solución Microsoft Antimalware para Azure incluye el cliente y el servicio de Microsoft Antimalware, el modelo de implementación clásica de Antimalware, los cmdlets de PowerShell para Antimalware y la extensión Azure Diagnostics. Microsoft Antimalware es compatible con las familias de sistemas operativos Windows Server 2008 R2, Windows Server 2012 y Windows Server 2012 R2. No se admite en el sistema operativo de Windows Server 2008 y tampoco es compatible en Linux.

El cliente y servicio de Microsoft Antimalware se instala de forma predeterminada en un estado deshabilitado en todas las familias de sistemas operativos invitados compatibles con Azure en la plataforma de Cloud Services. El cliente y el servicio de Microsoft Antimalware no se instalan de forma predeterminada en la plataforma de Virtual Machines, sino que está disponible como una característica opcional en Azure Portal y en la configuración de máquinas virtuales de Visual Studio en Extensiones de seguridad.

Si usa Azure App Service en Windows, el servicio subyacente que hospeda la aplicación web tiene Microsoft Antimalware habilitado. Esto se utiliza para proteger la infraestructura de Azure App Service y no se ejecuta en el contenido del cliente.

> [!NOTE]
> Windows Defender es el antimalware integrado habilitado en Windows Server 2016. La interfaz de Windows Defender también está habilitada de forma predeterminada en algunas SKU de Windows Server 2016 [consulte aquí para obtener más información](https://docs.microsoft.com/windows/threat-protection/windows-defender-antivirus/windows-defender-antivirus-on-windows-server-2016). La extensión de Antimalware de máquina virtual de Azure todavía puede agregarse a una máquina virtual de Azure de Windows Server 2016 con Windows Defender, pero en este escenario, la extensión aplicará cualquier [directiva de configuración](https://gallery.technet.microsoft.com/Antimalware-For-Azure-5ce70efe) opcional que vaya a usar Windows Defender, en vez de implementar servicios antimalware adicionales.
> Puede leer más sobre esta actualización [aquí](https://blogs.msdn.microsoft.com/azuresecurity/2017/03/07/update-to-azure-antimalware-extension-for-cloud-services/).

### <a name="microsoft-antimalware-workflow"></a>Flujo de trabajo de Microsoft Antimalware

El administrador de servicios de Azure puede habilitar Antimalware para Azure con una configuración predeterminada o personalizada para Máquinas virtuales y Cloud Services mediante las siguientes opciones:

* Virtual Machines: en Azure Portal, en **Extensiones de seguridad**
* Máquinas virtuales: mediante la configuración de máquinas virtuales de Visual Studio en el Explorador de servidores
* Virtual Machines y Cloud Services: con el [modelo de implementación clásica](https://msdn.microsoft.com/library/azure/ee460799.aspx) de Antimalware
* Virtual Machines y Cloud Services: mediante los cmdlets de PowerShell para Antimalware

Azure Portal o los cmdlets de PowerShell insertan el archivo del paquete de extensiones de Antimalware en el sistema de Azure en una ubicación fija predeterminada. El agente invitado de Azure (o el agente de tejido) inicia la extensión de Antimalware y aplicar los valores de configuración de Antimalware proporcionados como entrada. Este paso habilita el servicio Antimalware con valores de configuración predeterminados o personalizados. Si no se proporciona ninguna configuración personalizada, el servicio Antimalware se habilita con la configuración predeterminada. Consulte la sección *Configuración Antimalware* de los [ejemplos de código de Microsoft Antimalware para Azure](https://aka.ms/amazsamples "Ejemplos de código de Microsoft Antimalware para Azure Cloud Services y Virtual Machines") para obtener más información.

Una vez en ejecución, el cliente de Microsoft Antimalware descarga de Internet las definiciones más recientes de firmas y del motor de protección y las carga en el sistema de Azure. El servicio Microsoft Antimalware escribe eventos relacionados con el servicio en el registro de eventos del SO del sistema, en el origen del evento "Microsoft Antimalware". Los eventos incluyen, entre otros, el estado de mantenimiento, protección y corrección del cliente Antimalware, valores de configuración nuevos y antiguos, actualizaciones del motor y definiciones de firmas.

Puede habilitar la supervisión Antimalware para que en el servicio en la nube o la máquina virtual se escriban los eventos del registro de eventos Antimalware a medida que se generan en la cuenta de almacenamiento de Azure. El servicio Antimalware usa la extensión Diagnósticos de Azure para recopilar eventos Antimalware del sistema de Azure en tablas de la cuenta de Azure Storage del cliente.

El flujo de trabajo de implementación, que incluye pasos de configuración y opciones admitidas para los escenarios anteriores, se documenta en la sección [Escenarios de implementación de Antimalware](#antimalware-deployment-scenarios) de este documento.

![Microsoft Antimalware en Azure](./media/antimalware/sec-azantimal-fig1.PNG)

> [!NOTE]
> Sin embargo, puede usar las plantillas de Azure Resource Manager o las API/PowerShell para implementar conjuntos de escalado de máquinas virtuales con la extensión antimalware de Microsoft.  Para instalar una extensión en una máquina virtual que ya se esté ejecutando, puede usar el script de ejemplo de Python [vmssextn.py](https://github.com/gbowerman/vmsstools). Este script obtiene la configuración de extensión existente del conjunto de escalado y agrega una extensión a la lista de extensiones actuales de los conjuntos de escalado de máquinas virtuales.
>
>

### <a name="default-and-custom-antimalware-configuration"></a>Configuración predeterminada y personalizada de Antimalware

Si no se proporcionan valores de configuración personalizados, se aplican los valores de configuración predeterminados para habilitar Antimalware para Azure Cloud Services y Virtual Machines. Los valores de configuración predeterminados se han optimizado previamente para ejecutarse en el entorno de Azure. Opcionalmente, puede personalizar estos valores de configuración predeterminados para adaptarlos a la implementación de su aplicación o servicio de Azure y aplicarlos en otros escenarios de implementación.

En la tabla siguiente se resumen las opciones de configuración disponibles para el servicio Antimalware. La configuración predeterminada se marca en la columna "Predeterminada" que se muestra a continuación.

![Tabla 1](./media/antimalware/sec-azantimal-tb18.PNG)

## <a name="antimalware-deployment-scenarios"></a>Escenarios de implementación de Antimalware

Los escenarios para habilitar y configurar Antimalware, incluida la supervisión de Azure Cloud Services y Virtual Machines, se tratan en esta sección.

### <a name="virtual-machines---enable-and-configure-antimalware"></a>Virtual Machines: habilitación y configuración de Antimalware

#### <a name="deployment-while-creating-a-vm-using-the-azure-portal"></a>Implementación mientras crea una máquina virtual mediante Azure Portal

Para habilitar y configurar Microsoft Antimalware en Azure Virtual Machines mediante Azure Portal mientras aprovisiona una máquina virtual, siga estos pasos:

1. Inicie sesión en Azure Portal en <https://portal.azure.com>.
2. Para crear una nueva máquina virtual, vaya a **Máquinas virtuales**, seleccione **Agregar** y elija **Windows Server**.
3. Seleccione la versión de Windows Server que quiera usar.
4. Seleccione **Crear**.
    ![Crear la máquina virtual](./media/antimalware/create-vm.PNG)
5. Proporcione un **Nombre**, un **Nombre de usuario**, una **Contraseña** y cree un nuevo grupo de recursos o elija un grupo de recursos existente.
6. Seleccione **Aceptar**.
7. Seleccione un tamaño de máquina virtual.
8. En la sección siguiente, realice las elecciones adecuadas para sus necesidades, seleccione la sección **Extensiones**.
9. Seleccione **Agregar extensión**.
10. En **Nuevo recurso**, elija **Microsoft Antimalware**.
11. Seleccione **Crear**
12. En la sección **Instalar extensión** se puede configurar el archivo, las ubicaciones y las exclusiones del proceso, así como otras opciones de análisis. Elija **Aceptar**.
13. Elija **Aceptar**.
14. En la sección **Configuración**, elija **Aceptar**.
15. En la pantalla **Crear**, elija **Aceptar**.

#### <a name="deployment-using-the-visual-studio-virtual-machine-configuration"></a>Implementación mediante la configuración de máquinas virtuales de Visual Studio

Para habilitar y configurar el servicio Microsoft Antimalware con Visual Studio:

1. Conéctese a Microsoft Azure en Visual Studio.

2. Elija su máquina virtual en el nodo **Virtual Machines** del **Explorador de servidores**.

   ![Configuración de máquina virtual en Visual Studio](./media/antimalware/sec-azantimal-fig5.PNG)

3. Haga clic con el botón derecho en **configurar** para ver la página de configuración de máquinas virtuales.

4. Seleccione la extensión **Microsoft Antimalware** en la lista desplegable bajo **Extensiones instaladas** y haga clic en **Agregar** para realizar la configuración predeterminada de Antimalware.
    ![Extensiones instaladas](./media/antimalware/sec-azantimal-fig6.PNG)
5. Para personalizar la configuración predeterminada de Antimalware, seleccione (resalte) la extensión Antimalware en la lista de extensiones instaladas y haga clic en **Configurar**.

6. Reemplace la configuración predeterminada de Antimalware por la configuración personalizada en formato JSON admitido en el cuadro de texto **Configuración pública** y haga clic en Aceptar.

7. Haga clic en el botón **Actualizar** para insertar las actualizaciones de configuración en la máquina virtual.

    ![Extensión de configuración de máquina virtual](./media/antimalware/sec-azantimal-fig7.PNG)

> [!NOTE]
>La configuración de Virtual Machines de Visual Studio para Antimalware solo admite el formato JSON. La plantilla de configuración JSON de Antimalware se incluye en los [ejemplos de código de Microsoft Antimalware para Azure](https://aka.ms/amazsamples "Ejemplos de código de Microsoft Antimalware para Azure"), que muestra los valores de configuración de Antimalware admitidos.

#### <a name="deployment-using-powershell-cmdlets"></a>Implementación mediante cmdlets de PowerShell

Una aplicación o un servicio de Azure puede habilitar y configurar Microsoft Antimalware para Azure Virtual Machines mediante cmdlets de PowerShell.

Para habilitar y configurar Microsoft Antimalware con cmdlets de PowerShell:

1. Configure el entorno de PowerShell: consulte la documentación en <https://github.com/Azure/azure-powershell>.
2. Use [Set-AzureVMMicrosoftAntimalwareExtension Antimalware cmdlet]/powershell/module/servicemanagement/azure.service/set-azurevmmicrosoftantimalwareextension) para habilitar y configurar Microsoft Antimalware para la máquina virtual.

> [!NOTE]
>La configuración de Azure Virtual Machines para Antimalware solo admite el formato JSON. La plantilla de configuración JSON de Antimalware se incluye en los [ejemplos de código de Microsoft Antimalware para Azure](https://aka.ms/amazsamples "Ejemplos de código de Microsoft Antimalware para Azure"), que muestra los valores de configuración de Antimalware admitidos.

### <a name="enable-and-configure-antimalware-using-powershell-cmdlets"></a>Habilitación y configuración de Antimalware mediante cmdlets de PowerShell

Una aplicación o un servicio de Azure puede habilitar y configurar Microsoft Antimalware para Azure Cloud Services mediante cmdlets de PowerShell. Tenga en cuenta que Microsoft Antimalware se instala con un estado deshabilitado en la plataforma de Cloud Services y requiere la acción de una aplicación de Azure para habilitarlo.

Para habilitar y configurar Microsoft Antimalware mediante cmdlets de PowerShell:

1. Configure el entorno de PowerShell: consulte la documentación en <https://github.com/Azure/azure-powershell>.
2. Use el [cmdlet Set-AzureServiceAntimalwareExtension de Antimalware](/powershell/module/servicemanagement/azure.service/set-azureserviceantimalwareextension) para habilitar y configurar Microsoft Antimalware para su servicio en la nube.

La plantilla de configuración XML de Antimalware se incluye en los [ejemplos de código de Microsoft Antimalware para Azure](https://aka.ms/amazsamples "Ejemplos de código de Microsoft Antimalware para Azure"), que muestra los valores de configuración de Antimalware admitidos.

### <a name="cloud-services-and-virtual-machines---configuration-using-powershell-cmdlets"></a>Cloud Services y Virtual Machines: configuración mediante cmdlets de PowerShell

Una aplicación o un servicio de Azure puede recuperar la configuración de Microsoft Antimalware para Cloud Services y Virtual Machines mediante cmdlets de PowerShell.

Para recuperar la configuración de Microsoft Antimalware mediante cmdlets de PowerShell:

1. Configure el entorno de PowerShell: consulte la documentación en <https://github.com/Azure/azure-powershell>.
2. **Para Virtual Machines**: use el [cmdlet Get-AzureVMMicrosoftAntimalwareExtension de Antimalware](/powershell/module/servicemanagement/azure.service/get-azurevmmicrosoftantimalwareextension) para obtener la configuración de antimalware.
3. **Para Cloud Services**: use el [cmdlet Get-AzureServiceAntimalwareConfig Antimalware de Antimalware](/powershell/module/servicemanagement/azure.service/get-azureserviceantimalwareconfig) para obtener la configuración de antimalware.

### <a name="remove-antimalware-configuration-using-powershell-cmdlets"></a>Eliminación de la configuración de Antimalware mediante cmdlets de PowerShell

Una aplicación o un servicio de Azure puede quitar la configuración Antimalware, y cualquier configuración de supervisión de Antimalware asociada, de las extensiones pertinentes del servicio de diagnóstico y del servicio Antimalware de Azure asociadas al servicio en la nube o la máquina virtual.

Para quitar Microsoft Antimalware mediante cmdlets de PowerShell:

1. Configure el entorno de PowerShell: consulte la documentación en <https://github.com/Azure/azure-powershell>.
2. **Para Virtual Machines**: use el [cmdlet Remove-AzureVMMicrosoftAntimalwareExtension de Antimalware](/powershell/module/servicemanagement/azure.service/remove-azurevmmicrosoftantimalwareextension).
3. **Para Cloud Services**: use el [cmdlet Remove-AzureServiceAntimalwareExtension de Antimalware](/powershell/module/servicemanagement/azure.service/remove-azureserviceantimalwareextension).

Para **habilitar** la recopilación de eventos antimalware de una máquina virtual mediante el Portal de vista previa de Azure:

1. Haga clic en cualquier parte de la lente Supervisión en la hoja Máquina Virtual.
2. Haga clic en el comando Diagnóstico en la hoja Métrica.
3. Seleccione **Estado** activado y marque la opción para el sistema de eventos de Windows.
4. . Puede desactivar todas las demás opciones de la lista o dejarlas habilitadas, según las necesidades de su servicio de aplicación.
5. Las categorías de eventos Antimalware "Error", "Advertencia", "Informativo", etc., se capturan en la cuenta de Azure Storage.

Los eventos Antimalware se recopilan de los registros del sistema de eventos de Windows y se colocan en la cuenta de Azure Storage. Puede configurar la cuenta de almacenamiento de la máquina virtual para la recopilación de eventos Antimalware seleccionando la cuenta de almacenamiento adecuada.

![Métricas y diagnósticos](./media/antimalware/sec-azantimal-fig8.PNG)

> [!NOTE]
> Para más información sobre el registro de diagnósticos para Azure Antimalware, lea [Enabling Diagnostics Logging for Azure Antimalware (Habilitación del registro de diagnóstico para Azure Antimalware)](https://blogs.msdn.microsoft.com/azuresecurity/2016/04/19/enabling-diagnostics-logging-for-azure-antimalware/).

### <a name="enable-and-configure-antimalware-monitoring-using-powershell-cmdlets"></a>Habilitación y configuración de la supervisión antimalware mediante cmdlets de PowerShell

Puede habilitar la recopilación de eventos de Microsoft Antimalware para su servicio en la nube o máquina virtual usando Diagnósticos de Azure con cmdlets de PowerShell para Antimalware. La extensión Diagnósticos de Azure puede configurarse para capturar eventos del origen de registro de eventos del sistema "Microsoft Antimalware" y colocarlos en su cuenta de Azure Storage. Las categorías de eventos Antimalware "Error", "Advertencia", "Informativo", etc., se capturan en la cuenta de Azure Storage.

Para habilitar la recopilación de eventos Antimalware en su cuenta de Azure Storage mediante cmdlets de PowerShell:

1. Configure el entorno de PowerShell, consulte <https://github.com/Azure/azure-powershell>
2. **Para Virtual Machines**: use el [cmdlet Set-AzureVMMicrosoftAntimalwareExtension de Antimalware](/powershell/module/servicemanagement/azure.service/set-azurevmmicrosoftantimalwareextension) con la opción de supervisión activada.
3. **Para Cloud Services**: use el [cmdlet Set-AzureServiceAntimalwareExtension de Antimalware](/powershell/module/servicemanagement/azure.service/set-azureserviceantimalwareextension) con la opción de supervisión activada.

Puede ver los eventos sin procesar Antimalware si examina la tabla *WADWindowsEventLogsTable* de la cuenta de Azure Storage que configuró para habilitar la supervisión Antimalware. Esto puede ser útil para validar que la recopilación de eventos Antimalware funciona y para conocer el estado del servicio Antimalware. Para obtener más información, como el código de ejemplo sobre cómo extraer eventos Antimalware de la cuenta de almacenamiento, consulte los [ejemplos de código de Microsoft Antimalware para Azure](https://aka.ms/amazsamples "Ejemplos de código de Microsoft Antimalware para Azure").
