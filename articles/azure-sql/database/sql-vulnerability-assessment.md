---
title: Evaluación de vulnerabilidad de SQL
titleSuffix: Azure SQL Database & SQL Managed Instance & Azure Synapse Analytics
description: Aprenda a configurar la evaluación de vulnerabilidades de SQL y a interpretar los informes de evaluación en Azure SQL Database, Instancia administrada de Azure SQL y Azure Synapse Analytics.
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.custom: sqldbrb=3
ms.devlang: ''
ms.topic: conceptual
author: mibar
ms.author: mibar
ms.reviewer: vanto
ms.date: 07/28/2020
tags: azure-synapse
ms.openlocfilehash: e8f08f830142acfaa25d005651c9a44d17e21354
ms.sourcegitcommit: f353fe5acd9698aa31631f38dd32790d889b4dbb
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 07/29/2020
ms.locfileid: "87371811"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>La evaluación de vulnerabilidades de SQL ayuda a identificar los puntos vulnerables de la base de datos.
[!INCLUDE[appliesto-sqldb-sqlmi](../includes/appliesto-sqldb-sqlmi.md)]

La evaluación de vulnerabilidades de SQL es un servicio fácil de configurar que puede detectar, realizar un seguimiento y corregir posibles puntos vulnerables en la base de datos. Úsela para mejorar la seguridad de la base de datos de manera proactiva.

La evaluación de vulnerabilidades forma parte de la oferta de [Advanced Data Security](advanced-data-security.md), que es un paquete unificado de funcionalidades avanzadas de seguridad de SQL. Puede acceder a la evaluación de vulnerabilidades y administrarla a través del portal central de Advanced Data Security de SQL.

> [!NOTE]
> Se admite la evaluación de vulnerabilidad en Azure SQL Database, Instancia administrada de Azure SQL y Azure Synapse Analytics (antes Azure SQL Data Warehouse). En lo que resta de artículo, se hace referencia a las bases de datos de Azure SQL Database, Azure SQL Managed Instance y Azure Synapse Analytics colectivamente como "bases de datos", y por servidor se entiende el [servidor](logical-servers.md) donde se hospedan las bases de datos de Azure SQL Database y Azure Synapse.

## <a name="vulnerability-assessment"></a>Evaluación de vulnerabilidad

La evaluación de vulnerabilidades de SQL es un servicio que proporciona visibilidad del estado de seguridad. La evaluación de vulnerabilidades incluye pasos procesables para resolver problemas de seguridad y mejorar la seguridad de la base de datos. En este sentido, le puede ayudar a:

- Satisfacer los requisitos de cumplimiento que requieren los informes de examen de base de datos
- Cumplir los estándares de privacidad de los datos
- Supervisar un entorno de base de datos dinámico donde resulta difícil realizar un seguimiento de los cambios

La evaluación de vulnerabilidad es un servicio de detección integrado en Azure SQL Database. Este servicio emplea una base de conocimiento de reglas que marcan las vulnerabilidades de seguridad. Se resaltan las desviaciones de los procedimientos recomendados, como configuraciones inadecuadas, permisos excesivos y datos confidenciales desprotegidos.

Las reglas se basan en los procedimientos recomendados de Microsoft y se centran en los problemas de seguridad que presentan mayores riesgos para la base de datos y sus valiosos datos. Tratan los problemas de nivel de base de datos y los problemas de seguridad de nivel de servidor, como la configuración del firewall de servidor y los permisos de nivel de servidor. Estas reglas también representan muchos de los requisitos que deben cumplir diversos organismos reguladores para satisfacer los estándares de cumplimiento.

Los resultados del examen incluyen pasos que requieren acción para corregir cada uno de los problemas y proporcionan scripts de solución personalizados donde sea aplicable. Para personalizar un informe de evaluación de su entorno, debe establecer una línea de base aceptable de lo siguiente:

- Configuraciones de permisos
- Configuraciones de características
- Configuración de base de datos

## <a name="implement-vulnerability-assessment"></a>Implementación de una evaluación de vulnerabilidades

Con los siguientes pasos se implementa una evaluación de vulnerabilidades:

### <a name="1-run-a-scan"></a>1. Ejecución de un examen

1. Vaya al recurso de Azure SQL Database, Instancia administrada de SQL o Azure Synapse en [Azure Portal](https://portal.azure.com).

1. En el encabezado **Seguridad**, seleccione **Advanced Data Security**.

1. Luego, haga clic en **Seleccionar almacenamiento** en el panel **Evaluación de vulnerabilidades** para abrir el panel Configuración de la evaluación de vulnerabilidades de todo el servidor o instancia administrada.  

    > [!NOTE]
    > Para obtener más información sobre el almacenamiento de exámenes de evaluación de vulnerabilidades detrás de firewalls y redes virtuales, consulte [Almacenamiento de los resultados del examen de evaluación de vulnerabilidad en una cuenta de almacenamiento accesible detrás de firewalls y redes virtuales](sql-database-vulnerability-assessment-storage.md).

1. Configure una cuenta de almacenamiento en la que se almacenarán los resultados del examen de todas las bases de datos del servidor o instancia administrada. Para más información sobre las cuentas de almacenamiento, vea [Acerca de las cuentas de almacenamiento de Azure](../../storage/common/storage-account-create.md). Una vez configurado el almacenamiento, seleccione **Examinar** para examinar la base de datos en busca de vulnerabilidades.

![Examen de una base de datos](./media/sql-vulnerability-assessment/pp_va_initialize.png)

  > [!NOTE]
  > El examen es ligero y seguro. Tarda unos segundos en ejecutarse y es completamente de lectura. No realiza ningún cambio en la base de datos.

### <a name="2-view-the-report"></a>2. Visualización del informe

Una vez completado el examen, el informe del examen se muestra automáticamente en Azure Portal. El informe presenta una visión general del estado de seguridad. En él se muestra el número de problemas encontrados y sus respectivos niveles de gravedad. Los resultados incluyen advertencias sobre las desviaciones con respecto a los procedimientos recomendados, así como una instantánea de la configuración relacionada con la seguridad, como las entidades de seguridad y los roles de base de datos y sus permisos asociados. El informe de examen también proporciona un mapa de los datos confidenciales detectados en la base de datos, e incluye recomendaciones para clasificar los datos por medio de la [detección y clasificación de datos](data-discovery-and-classification-overview.md).

![Visualización del informe](./media/sql-vulnerability-assessment/pp_main_getstarted.png)

### <a name="3-analyze-the-results-and-resolve-issues"></a>3. Análisis de resultados y solución de problemas

Revise los resultados y determine qué resultados del informe son, verdaderamente, problemas de seguridad en su entorno. Examine con detalle cada resultado erróneo para entender el impacto de la búsqueda y por qué se ha producido un error en las comprobaciones de seguridad. Use la información de corrección que requiere acción que se proporciona en el informe para resolver el problema.

![Análisis del informe](./media/sql-vulnerability-assessment/pp_fail_rule_show_remediation.png)

### <a name="4-set-your-baseline"></a>4. Establecimiento de la línea base

Cuando revise los resultados de la evaluación, puede marcar los resultados específicos como una *línea de base* aceptable en su entorno. La línea de base es fundamentalmente una personalización de cómo se notifican los resultados. Los resultados que coinciden con la línea de base se consideran como correctos en análisis posteriores. Una vez establecido el estado de seguridad de línea de base, la evaluación de vulnerabilidades solo informa de las desviaciones con respecto a esa línea de base. De esta manera, podrá centrar su atención en los problemas relevantes.

![Establecimiento de la línea base](./media/sql-vulnerability-assessment/pp_fail_rule_show_baseline.png)

### <a name="5-run-a-new-scan-to-see-your-customized-tracking-report"></a>5. Ejecución de un nuevo examen para ver el informe de seguimiento personalizado

Después de completar la configuración de sus **líneas de base de la regla**, ejecute un examen nuevo para ver el informe personalizado. Ahora, la evaluación de vulnerabilidades informa solo de los problemas de seguridad que se desvían de la línea de base aprobada.

![Visualización del informe personalizado](./media/sql-vulnerability-assessment/pp_pass_main_with_baselines.png)

La evaluación de vulnerabilidad puede usarse ahora para supervisar que la base de datos mantenga un alto nivel de seguridad en todo momento y que se cumplan las directivas de la organización. Si se requieren informes de cumplimiento, los informes de evaluación de vulnerabilidades pueden ser útiles para facilitar el proceso de cumplimiento.

### <a name="6-set-up-periodic-recurring-scans"></a>6. Configuración de exámenes periódicos

Vaya a la opción Evaluación de vulnerabilidades para activar **Exámenes periódicos**. Esta opción configura la evaluación de vulnerabilidades para ejecutar automáticamente un examen en la base de datos una vez por semana. Un resumen de los resultados de los exámenes se envía a las direcciones de correo electrónico que especifique.

![Visualización del informe personalizado](./media/sql-vulnerability-assessment/pp_recurring_scans.png)

### <a name="7-export-an-assessment-report"></a>7. Exportación de un informe de evaluación

Seleccione **Exportar resultados del examen** para crear un informe de Excel del resultado del examen que se pueda descargar. Este informe contiene una pestaña de resumen que muestra un resumen de la evaluación, incluidas todas las comprobaciones con errores. También incluye una pestaña **Resultados**, que refleja el conjunto completo de resultados del examen. Los resultados incluyen todas las comprobaciones que se han ejecutado y los detalles de resultado de cada una de ellas.

### <a name="8-view-scan-history"></a>8. Visualización del historial de exámenes

Seleccione **Historial de exámenes** en el panel Evaluación de vulnerabilidades para ver el historial de todos los exámenes ejecutados previamente en la base de datos. Seleccione un examen concreto en la lista para ver los resultados detallados del examen.

La evaluación de vulnerabilidad puede usarse ahora para supervisar que la base de datos mantenga un alto nivel de seguridad en todo momento y que se cumplan las directivas de la organización. Si se requieren informes de cumplimiento, los informes de evaluación de vulnerabilidades pueden ser útiles para facilitar el proceso de cumplimiento.

## <a name="manage-vulnerability-assessments-by-using-azure-powershell"></a>Administrar las evaluaciones de vulnerabilidades con Azure PowerShell

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]
> [!IMPORTANT]
> El módulo de Azure Resource Manager para PowerShell todavía es compatible, pero todo el desarrollo futuro se realizará para el módulo Az.Sql. Para estos cmdlets, consulte [AzureRM.Sql](https://docs.microsoft.com/powershell/module/AzureRM.Sql/). Los argumentos para los comandos del módulo Az y los módulos AzureRm son esencialmente idénticos.

Puede usar los cmdlets de Azure PowerShell para administrar mediante programación sus evaluaciones de vulnerabilidad. Los cmdlets compatibles son:

| Nombre del cmdlet como vínculo | Descripción |
| :-------------------- | :---------- |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Borra la base de referencia de la regla de evaluación de vulnerabilidades.<br/>En primer lugar, establezca la línea de base antes de usar este cmdlet para eliminarla. |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting) | Borra la configuración de evaluación de vulnerabilidades de una base de datos. |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Borra la base de referencia de la regla de evaluación de vulnerabilidad de una base de datos administrada.<br/>En primer lugar, establezca la línea de base antes de usar este cmdlet para eliminarla. |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Borra la configuración de la evaluación de vulnerabilidad de una base de datos administrada. |
| [Clear-AzSqlInstanceVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Clear-AzSqlInstanceVulnerabilityAssessmentSetting) | Borra la configuración de la evaluación de vulnerabilidad de una instancia administrada. |
| [Convert-AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan) | Convierte los resultados del examen de evaluación de vulnerabilidad de una base de datos en un archivo de Excel. |
| [Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Convierte los resultados del examen de evaluación de vulnerabilidad de una base de datos administrada en un archivo de Excel. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Obtiene la base de referencia de la regla de evaluación de vulnerabilidad de una base de datos de una regla dada. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Obtiene la base de referencia de la regla de evaluación de vulnerabilidad de una base de datos administrada de una regla dada. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord) | Obtiene todos los registros de examen de evaluación de vulnerabilidades asociados con una base de datos dada. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord](https://docs.microsoft.com/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord) | Obtiene todos los registros de examen de evaluación de vulnerabilidad asociados con una base de datos administrada dada. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting) | Devuelve la configuración de evaluación de vulnerabilidades de una base de datos. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Devuelve la configuración de la evaluación de vulnerabilidad de una base de datos administrada. |
| [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Establece la base de referencia de la regla de evaluación de vulnerabilidades. |
| [Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Establece la base de referencia de la regla de evaluación de vulnerabilidad de una base de datos administrada. |
| [Start-AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan) | Desencadena el inicio de un examen de evaluación de vulnerabilidad en una base de datos. |
| [Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Desencadena el inicio de un examen de evaluación de vulnerabilidad en una base de datos administrada. |
| [Update-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting) | Actualiza la configuración de evaluación de vulnerabilidades de una base de datos. |
| [Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Actualiza la configuración de la evaluación de vulnerabilidad de una base de datos administrada. |
| [Update-AzSqlInstanceVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Update-AzSqlInstanceVulnerabilityAssessmentSetting) | Actualiza la configuración de la evaluación de vulnerabilidad de una instancia administrada. |
| &nbsp; | &nbsp; |

Para obtener un ejemplo de script, consulte [Azure SQL Vulnerability Assessment PowerShell support](https://blogs.msdn.microsoft.com/sqlsecurity/20../../azure-sql-vulnerability-assessment-now-with-powershell-support/) (soporte técnico de PowerShell para la valoración de vulnerabilidades de Azure SQL).

## <a name="manage-vulnerability-assessment-baseline-rules-by-using-resource-manager-templates"></a>Administración de reglas de línea de base de evaluación de vulnerabilidades con plantillas de Resource Manager

Para configurar las líneas de base de evaluación de vulnerabilidades mediante plantillas de Azure Resource Manager, debe usar el tipo `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines`.

Antes de agregar líneas base, asegúrese de haber habilitado `vulnerabilityAssessments`.

Este es un ejemplo para definir la regla de línea de base VA2065 en la base de datos `master` y VA1143 en la base de datos `user` como recursos en una plantilla de Resource Manager:

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

En la base de datos `master` y la base de datos `user`, los nombres de los recursos se definen de forma diferente:

- Base de datos maestra: "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/<b>master</b>')]",
- Base de datos de usuario: "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/<b>default</b>')]",

Para controlar tipos de booleanos como true o false, establezca el resultado de la línea de base con entrada binaria como "1"/"0".

```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
      "apiVersion": "2018-06-01-preview",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## <a name="next-steps"></a>Pasos siguientes  

- Más información sobre [Advanced Data Security](advanced-data-security.md)
- Más información sobre la [clasificación y detección de datos](data-discovery-and-classification-overview.md)
- Obtenga más información sobre el [Almacenamiento de los resultados del examen de evaluación de vulnerabilidad en una cuenta de almacenamiento accesible detrás de firewalls y redes virtuales](sql-database-vulnerability-assessment-storage.md).
